<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	locale="#{localeBean.usedLocale}"
	xmlns:f="http://java.sun.com/jsf/core">


	<h:form id="form">
		<h2 style="color: #007d4c;">PROYECTOS > LOTES</h2>
		<h:panelGrid columns="10" width="50%" id="panelFilter">
			<h:outputLabel for="statusFilter" value="Estado: " style="text-align:right"/>
			<p:selectOneMenu id="statusFilter" value="#{loteBean.status}">
				<f:selectItem itemLabel="[--Todos--]" itemValue=""/>
				<f:selectItem itemLabel="Disponibles" itemValue="Disponible" />
				<f:selectItem itemLabel="Separados" itemValue="Separado"/>
				<f:selectItem itemLabel="Vendidos" itemValue="Vendido"/>
				<f:selectItem itemLabel="Inactivos" itemValue="Inactivo"/>
				<p:ajax update="idTableLote" />
			</p:selectOneMenu>
			
			<h:outputLabel for="optionProject" value="Proyecto: " style="text-align:right"/>
			<p:selectOneMenu id="optionProject" value="#{loteBean.projectFilter}" converter="#{loteBean.conversorProject}">
				<f:selectItem itemLabel="[--Todos--]" itemValue="#{null}"/>
				<f:selectItems value="#{loteBean.lstProject}" var="proy" itemLabel="#{proy.name}" itemValue="#{proy}"/>
				<p:ajax update=":form:idTableLote :form:panelFilter" />
			</p:selectOneMenu>
			
			<h:outputLabel for="optionManzana" value="Manzana: " style="text-align:right"/>
            <p:autoComplete scrollHeight="300" onkeyup="javascript:this.value=this.value.toUpperCase();" styleClass="ui-autocompV" value="#{loteBean.manzanaFilter}" converter="#{loteBean.conversorManzana}" id="optionManzana" completeMethod="#{loteBean.completeManzana}"  
                          var="ase" itemLabel="#{ase.name}" itemValue="#{ase}" forceSelection="true"  > 
            	<p:ajax update="idTableLote" />
            </p:autoComplete>
            
            <p:commandButton id="images" icon="pi pi-image" rendered="#{loteBean.projectFilter != null}" oncomplete="PF('imagenDialog').show();" update="dialogImagen"/>
            
            <p:commandButton id="mapeo" icon="pi pi-th-large" rendered="#{loteBean.projectFilter != null}" oncomplete="PF('mapeoDialog').show();" update="dialogMapeo"/>
            
		
		</h:panelGrid>
		
		

		<p:dataTable var="lote" id="idTableLote" value="#{loteBean.lstLoteLazy}" widgetVar="loteTable" rowIndexVar="row" paginator="true" rows="15"
			size="small" emptyMessage="No se encontraron lotes." paginatorPosition="bottom" rowKey="#{lote.id}" selection="#{loteBean.loteSelected}" selectionMode="single">
			<f:facet name="header">
				<div class="p-d-flex p-ai-center p-jc-between">
					<span>Lista de Lotes</span>
				</div>
			</f:facet>
			<p:ajax event="rowSelect" listener="#{loteBean.modifyLote()}" update=":formLoteDialog :dialogLote :form:idTableLote " oncomplete="PF('loteDialog').show();" />
			<p:column style="width:42px;text-align: left">
				<f:facet name="header">
					<p:commandLink action="#{loteBean.newLote()}" update=":formLoteDialog :dialogLote" oncomplete="PF('loteDialog').show();" title="NUEVO LOTE">
						<p:graphicImage width="50" value="/recursos/images/anadir.png" />
					</p:commandLink>
				</f:facet>
			</p:column>

			<p:column width="25px">
                      #{row +1}
        	</p:column>

			<p:column headerText="Número de Lote" sortBy="#{lote.numberLote}"  filterMatchMode="contains">
				<h:outputText value="#{lote.numberLote}" />
			</p:column>
			
			<p:column headerText="Manzana" sortBy="#{lote.manzana.name}" filterMatchMode="contains">
				<h:outputText value="#{lote.manzana.name}" />
			</p:column>
			
			<p:column headerText="Ampliación" sortBy="#{lote.ampliacion}" filterMatchMode="contains">
				<h:outputText value="#{lote.ampliacion eq 'S'?'Si':'No'}" />
			</p:column>
			
			<p:column headerText="Proyecto" sortBy="#{lote.project.name}"
                      filterMatchMode="exact">
                <h:outputText value="#{lote.project.name}" />
            </p:column>
            
            <p:column headerText="Medida frontal(ML)" filterMatchMode="contains">
				<h:outputText value="#{lote.medidaFrontal}" />
			</p:column>
			
			<p:column headerText="Medida costado derecho (ML)" filterMatchMode="contains">
				<h:outputText value="#{lote.medidaDerecha}" />
			</p:column>
			
			<p:column headerText="Medida costado izquierdo (ML)" filterMatchMode="contains">
				<h:outputText value="#{lote.medidaIzquierda}" />
			</p:column>
			
			<p:column headerText="Medida fondo (ML)" filterMatchMode="contains">
				<h:outputText value="#{lote.medidaFondo}" />
			</p:column>
			
			<p:column headerText="Área de lote (M2)" filterMatchMode="contains">
				<h:outputText value="#{lote.area}" />
			</p:column>
			
			<p:column headerText="Perímetro (ML)" filterMatchMode="contains">
				<h:outputText value="#{lote.perimetro}" />
			</p:column>
			
			<p:column headerText="Estado" filterMatchMode="contains">
				<h:outputText value="#{lote.status}" style="font-weight: bold;color:#{lote.status eq 'Disponible'?'green':lote.status eq 'Separado'?'blue':lote.status eq 'Vendido'?'red':'black'}" />
			</p:column>
		</p:dataTable>

	</h:form>
	
	<p:dialog modal="true" dynamic="true" closeOnEscape="true" id="dialogLote" header="#{loteBean.tituloDialog}" widgetVar="loteDialog" resizable="false" closable="true"
		appendTo="@(body)" style="width:auto">
		<h:form id="formLoteDialog">
			<h:outputLabel value="#{loteBean.nombreLoteSelected}" style="color: #007d4c;font-weight: bolder;" id="nomLoteSelect" />
		
			<p:tabView id="tabOpciones"> 
				<p:tab title="Descripción" >
					<p:messages id="messages" showDetail="true" closable="true">
						<p:autoUpdate />
					</p:messages>
					<h:panelGrid id="grid" columns="2">
						<h:outputLabel value="Número de Lote: " for="nombreLote" />
						<p:inputText value="#{loteBean.loteNew.numberLote}" style="margin:5px; width:220px" id="nombreLote" maxlength="10" disabled="#{!loteBean.modificar}" ><p:ajax update="messages" /> </p:inputText>
					
						<h:outputLabel for="manzana" value="Manzana: " />
						<p:selectOneMenu style="margin:5px; width:220px" id="manzana" value="#{loteBean.loteNew.manzana}" disabled="#{!loteBean.modificar}" converter="#{loteBean.conversorManzana}"> 
							<f:selectItem itemLabel="[-- Selecionar --]" itemValue="#{null}"/>
							<f:selectItems value="#{loteBean.lstManzana}" var="manz" itemLabel="#{manz.name}" itemValue="#{manz}"/>
							<p:ajax update="messages" />
						</p:selectOneMenu>
						
						<h:outputLabel for="amplia" value="Ampliación: " />
						<p:selectOneMenu style="margin:5px; width:220px" id="amplia" value="#{loteBean.loteNew.ampliacion}" disabled="#{!loteBean.modificar}">
							<f:selectItem itemLabel="No" itemValue="N"/>
							<f:selectItem itemLabel="Si" itemValue="S"/>
							<p:ajax update="messages" />
						</p:selectOneMenu>
					
						<h:outputLabel for="proyecto" value="Proyecto:" />
						<p:selectOneMenu style="margin:5px; width:220px" id="proyecto" value="#{loteBean.loteNew.project}" converter="#{loteBean.conversorProject}" disabled="#{!loteBean.modificar}">
							<f:selectItem itemLabel="[-- Selecionar --]" itemValue="#{null}"/>
							<f:selectItems value="#{loteBean.lstProject}" var="proy" itemLabel="#{proy.name}" itemValue="#{proy}"/>
							<p:ajax update="messages" />
						</p:selectOneMenu>
						
						<h:outputLabel for="option" value="Estado:" />
						<p:selectOneMenu id="option" value="#{loteBean.loteNew.status}" style="margin:5px; width:220px" disabled="#{!loteBean.modificar}">
							<f:selectItem itemLabel="Disponible" itemValue="Disponible" />
							<f:selectItem itemLabel="Separado" itemValue="Separado"/>
							<f:selectItem itemLabel="Vendido" itemValue="Vendido"/>
							<f:selectItem itemLabel="Inactivo" itemValue="Inactivo"/>
							<p:ajax update="messages" />
						</p:selectOneMenu>
					
						<p:commandButton value="Guardar" action="#{loteBean.saveLote()}" update=":form:idTableLote :formLoteDialog" rendered="#{loteBean.modificar}" />
					</h:panelGrid>
				</p:tab>
				<p:tab title="Medidas" >
					<h:panelGrid id="gridMedidas" columns="2">
						<h:outputLabel value="Medida frontal (ML): " for="medidaFrontal" />
						<p:inputNumber id="medidaFrontal" value="#{loteBean.loteNew.medidaFrontal}" modifyValueOnWheel="false" disabled="#{!loteBean.modificar}" ><p:ajax listener="#{loteBean.calcularAreaPerimetro}" update="messages,areaLote,perimetro" /> </p:inputNumber>
						
						<h:outputLabel value="Medida costado derecho (ML): " for="medidaCostDerecho" />
						<p:inputNumber id="medidaCostDerecho" value="#{loteBean.loteNew.medidaDerecha}" modifyValueOnWheel="false" disabled="#{!loteBean.modificar}"><p:ajax listener="#{loteBean.calcularAreaPerimetro}" update="messages,areaLote,perimetro" /> </p:inputNumber>	
						
						<h:outputLabel value="Medida costado izquierdo (ML): " for="medidaCostIzq" />
						<p:inputNumber id="medidaCostIzq" value="#{loteBean.loteNew.medidaIzquierda}" modifyValueOnWheel="false" disabled="#{!loteBean.modificar}"><p:ajax listener="#{loteBean.calcularAreaPerimetro}" update="messages,areaLote,perimetro" /></p:inputNumber>
						
						<h:outputLabel value="Medida fondo (ML): " for="medidaFondo" />
						<p:inputNumber id="medidaFondo" value="#{loteBean.loteNew.medidaFondo}" modifyValueOnWheel="false" disabled="#{!loteBean.modificar}"><p:ajax listener="#{loteBean.calcularAreaPerimetro}" update="messages,areaLote,perimetro" /></p:inputNumber>
						
						<h:outputLabel value="Área de lote (M2): " for="areaLote" />
						<p:inputNumber id="areaLote" value="#{loteBean.loteNew.area}" modifyValueOnWheel="false" disabled="#{!loteBean.modificar}"><p:ajax update="messages" /> </p:inputNumber>
						
						<h:outputLabel value="Perímetro (ML): " for="perimetro" />
						<p:inputNumber id="perimetro" value="#{loteBean.loteNew.perimetro}" modifyValueOnWheel="false" disabled="#{!loteBean.modificar}"><p:ajax update="messages" /> </p:inputNumber>		
					</h:panelGrid>
				</p:tab>
				<p:tab title="Límites" > 
					<h:panelGrid id="gridLimites" columns="2">
						<h:outputLabel value="Límite frontal: " for="limiteFrontal" />
						<p:inputText id="limiteFrontal" value="#{loteBean.loteNew.limiteFrontal}" modifyValueOnWheel="false" maxlength="45" disabled="#{!loteBean.modificar}"><p:ajax update="messages" /> </p:inputText>
						
						<h:outputLabel value="Límite costado derecho (ML): " for="limiteCostDerecho" />
						<p:inputText id="limiteCostDerecho" value="#{loteBean.loteNew.limiteDerecha}" modifyValueOnWheel="false" maxlength="45" disabled="#{!loteBean.modificar}"><p:ajax update="messages" /> </p:inputText>		
						
						<h:outputLabel value="Límite costado izquierdo (ML): " for="limiteCostIzq" />
						<p:inputText id="limiteCostIzq" value="#{loteBean.loteNew.limiteIzquierda}" modifyValueOnWheel="false" maxlength="45" disabled="#{!loteBean.modificar}"><p:ajax update="messages" /> </p:inputText>
						
						<h:outputLabel value="Límite fondo (ML): " for="limiteFondo" />
						<p:inputText id="limiteFondo" value="#{loteBean.loteNew.limiteFondo}" modifyValueOnWheel="false" maxlength="45" disabled="#{!loteBean.modificar}"><p:ajax update="messages" /> </p:inputText>
						
						<h:outputLabel value="Comentario: " for="comentario" />
						<p:inputText id="comentario" value="#{loteBean.loteNew.comentario}" modifyValueOnWheel="false" maxlength="50" disabled="#{!loteBean.modificar}"><p:ajax update="messages" /> </p:inputText>
					</h:panelGrid>
				</p:tab>
			</p:tabView>	
		</h:form>
	</p:dialog>
	
	<p:dialog modal="true" dynamic="true" height="500px" closeOnEscape="true" id="dialogImagen" header="Mapeo de lotes del proyecto: #{loteBean.projectFilter.name}" widgetVar="imagenDialog" resizable="false" closable="true"
		appendTo="@(body)" style="width:auto">
		<h:form id="formImagenDialog">
			<p:graphicImage value="/recursos/images/proyectos/proyecto#{loteBean.projectFilter.id}.jpg" style="width: 660px;"/>
		</h:form>
	</p:dialog>
	
	<p:dialog modal="true" dynamic="true" closeOnEscape="true" id="dialogMapeo" header="Mapeo de lotes del proyecto: #{loteBean.projectFilter.name}" widgetVar="mapeoDialog" resizable="false" closable="true"
		appendTo="@(body)" style="width:auto">
		<h:form id="formMapeoDialog">
			
		</h:form>
	</p:dialog>


</ui:composition>