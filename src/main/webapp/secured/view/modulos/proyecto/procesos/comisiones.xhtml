<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	locale="#{localeBean.usedLocale}"
	xmlns:f="http://java.sun.com/jsf/core">


	<h:form id="form">
		<h2 style="color: #007d4c;">PROYECTOS > COMISIONES</h2>
		<h:panelGrid id="grid" columns="8" width="95%">
			<h:outputLabel for="optionComision" value="Comision:" />
			<p:selectOneMenu id="optionComision" value="#{comisionesBean.comisionSelected}" converter="#{comisionesBean.conversorComision}" style="margin:10px">
				<f:selectItems value="#{comisionesBean.lstComision}" var="com" itemLabel="#{com.codigo} : #{comisionesBean.sdf.format(com.fechaIni)}-#{comisionesBean.sdf.format(com.fechaCierre)}" itemValue="#{prof}" />
				<p:ajax listener="#{comisionesBean.cambiarComision}" update="idTeamTable, comCont, comCred" />
			</p:selectOneMenu>
			
			<h:outputLabel for="comCont" value="Comisión Contado: "  />
			<h:outputLabel id="comCont" value="#{comisionesBean.comisionSelected.comisionContado}%" style="font-weight: bold;"/>  
				 
			
			<h:outputLabel for="comCred" value="Comisión Crédito: " />
			<h:outputLabel id="comCred" value="#{comisionesBean.comisionSelected.comisionCredito}%" style="font-weight: bold;" />
			
			<h:outputLabel for="meta" value="Meta: " />
			<h:outputLabel id="meta" value="#{comisionesBean.comisionSelected.meta}" style="font-weight: bold;" />

           	
		</h:panelGrid>
		
		<p:dataTable var="team" id="idTeamTable" value="#{comisionesBean.lstTeamLazy}" widgetVar="idTeamTable" rowIndexVar="row" paginator="true" rows="15" style="width:100%"
			size="small" emptyMessage="No se encontraron lotes." paginatorPosition="bottom" rowKey="#{lote.id}" selection="#{comisionesBean.teamSelected}" selectionMode="single">
			
			<p:column width="25px">
                      #{row +1}
        	</p:column>
        	<p:column headerText="Nombre de Equipo" sortBy="#{team.name}"  filterMatchMode="contains" >
				<h:outputText value="#{team.name}"/>
			</p:column>
			<p:column headerText="Supervisor" sortBy="#{team.personSupervisor.surnames}"  filterMatchMode="contains" >
				<h:outputText value="#{team.personSupervisor.surnames} #{team.personSupervisor.names}" />
			</p:column>
			<p:column headerText="Lotes vendidos" filterMatchMode="contains" >
				<h:outputText value="#{comisionesBean.calcularProcentajeMeta(team,'SI')}" />
			</p:column>
			
			<p:column headerText="% Meta" filterMatchMode="contains">
				 <p:progressBar value="#{comisionesBean.calcularProcentajeMeta(team,'NO')}" labelTemplate="{value}%" displayOnly="true"/>
			</p:column>
		</p:dataTable>
		<p:contextMenu for="idTeamTable">
            <p:menuitem value="Detalle Lotes" update="dialogComision" action="#{comisionesBean.verDetalleLotes}" icon="pi pi-search" oncomplete="PF('comisionDialog').show()"/>
            <p:menuitem value="Detalle Asesores" update="dialogAsesor" action="#{comisionesBean.verDetalleAsesores}" icon="pi pi-search" oncomplete="PF('asesorDialog').show()"/>
        </p:contextMenu>
	</h:form>
	
	<p:dialog modal="true" dynamic="true" closeOnEscape="true" id="dialogComision" header="Equipo: #{comisionesBean.teamSelected.name}" widgetVar="comisionDialog" resizable="false" closable="true"
		appendTo="@(body)" style="width:auto">
		<h:form id="formComisionDialog">
			<h:outputText value="¡El equipo a completado la meta!"  style="color: red;font-weight: bolder;" rendered="#{comisionesBean.metaEquipo}"/>
			
			<p:dataTable var="lote" id="idTableLote" value="#{comisionesBean.lstLoteLazy}" widgetVar="loteTable" rowIndexVar="row" paginator="true" rows="10" style="width:130%"
				size="small" emptyMessage="No se encontraron lotes vendidos." paginatorPosition="bottom" rowKey="#{lote.id}" selectionMode="single">
				<p:column width="25px">
	                      #{row +1}
	        	</p:column>
	        	<p:column headerText="Asesor" sortBy="#{lote.personAssessor.surnames}"  filterMatchMode="contains" style="width: 200px">
					<h:outputText value="#{lote.personAssessor.surnames} #{lote.personAssessor.names}" />
				</p:column>
				
				<p:column headerText="DNI / Comprador" sortBy="#{lote.personVenta.surnames}"  filterMatchMode="contains" style="width: 400px">
					<h:outputText value="#{lote.personVenta.dni} / #{lote.personVenta.surnames} #{lote.personVenta.names}" />
				</p:column>				
				<p:column headerText="Fecha Venta" filterMatchMode="contains">
					<h:outputText value="#{lote.fechaVendido}"> 
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>
				<p:column headerText="Tipo Pago" sortBy="#{lote.tipoPago}" filterMatchMode="contains" style="text-align: center">
	                <h:outputText value="#{lote.tipoPago}" />
	            </p:column>
	            <p:column headerText="Cuotas" sortBy="#{lote.numeroCuota}" filterMatchMode="contains" style="text-align: center">
	                <h:outputText value="#{lote.numeroCuota}" />
	            </p:column>
	            <p:column headerText="% Comisión" filterMatchMode="contains" style="text-align: center">
	                <h:outputText value="#{lote.tipoPago eq 'Contado'?comisionesBean.comisionSelected.comisionContado:comisionesBean.comisionSelected.comisionCredito}" />
	            </p:column>
	            <p:column headerText="Proyecto" sortBy="#{lote.project.name}" filterMatchMode="contains" style="width: 300px">
	                <h:outputText value="#{lote.project.name}" />
	            </p:column>
	            <p:column headerText="Manz-Lote" sortBy="#{lote.numberLote}"  filterMatchMode="contains" style="text-align: center">
					<h:outputText value="#{lote.manzana.name}-#{lote.numberLote}" />
				</p:column>
				<p:column headerText="Precio Final" sortBy="#{lote.montoVenta}"  filterMatchMode="contains" style="text-align: center">
					<h:outputText value="#{lote.montoVenta}" >
	                    <f:convertNumber currencySymbol="" type="currency"  />
	                </h:outputText>
				</p:column>
				<p:column headerText="Inicial" sortBy="#{lote.montoInicial}"  filterMatchMode="contains" style="text-align: center">
					<h:outputText value="#{lote.montoInicial}" >
	                    <f:convertNumber currencySymbol="" type="currency"  />
	                </h:outputText>
				</p:column>
				<p:column headerText="Comisión Asesor" filterMatchMode="contains" style="text-align: center">
					<h:outputText value="#{comisionesBean.calcularComisionAsesor(lote)}" >
	                    <f:convertNumber currencySymbol="" type="currency"  />
	                </h:outputText>
				</p:column>
				<p:column headerText="Comisión Supervisor" filterMatchMode="contains" style="text-align: center">
					<h:outputText value="#{comisionesBean.calcularComisionSupervior(lote)}" >
	                    <f:convertNumber currencySymbol="" type="currency"  />
	                </h:outputText> 
				</p:column>
				<p:column headerText="Comisión Subgerente" filterMatchMode="contains" style="text-align: center">
					<h:outputText value="#{comisionesBean.calcularComisionSubgerente(lote)}" >
	                    <f:convertNumber currencySymbol="" type="currency"  />
	                </h:outputText>
				</p:column>
			</p:dataTable>
		</h:form>
	</p:dialog>
	
	<p:dialog modal="true" dynamic="true" closeOnEscape="true" id="dialogAsesor" header="Detalle asesores: #{comisionesBean.teamSelected.name}" widgetVar="asesorDialog" resizable="false" closable="true"
		appendTo="@(body)" style="width:auto">
		<h:form id="formAsesorDialog">
			<p:dataTable var="asesor" id="idTableLote" value="#{comisionesBean.lstPersonAsesor}" widgetVar="loteTable" rowIndexVar="row" paginator="true" rows="10"
				size="small" emptyMessage="No se encontraron resultados." paginatorPosition="bottom" rowKey="#{asesor.id}" selectionMode="single">
				<p:column width="25px">
	                      #{row +1}
	        	</p:column>
	        	<p:column headerText="Asesor" sortBy="#{asesor.surnames}"  filterMatchMode="contains">
					<h:outputText value="#{asesor.surnames} #{asesor.names}" />
				</p:column>
				<p:column headerText="Sueldo Básico" filterMatchMode="contains" style="text-align: center" >
					<h:outputText value="#{comisionesBean.obtenerSueldoBasicoAsesor(asesor)}" />
				</p:column>
				<p:column headerText="Total Vendido"   filterMatchMode="contains"  style="text-align: center">
					<h:outputText value="#{asesor.lotesVendidos}" />
				</p:column>
				<p:column headerText="Total Vendido Contado"   filterMatchMode="contains"  style="text-align: center">
					<h:outputText value="#{asesor.lotesContado}" />
				</p:column>
				<p:column headerText="Total Comisión Contado"   filterMatchMode="contains"  style="text-align: center">
					<h:outputText value="#{asesor.comisionContado}" />
				</p:column>
				<p:column headerText="Total Vendido Crédito"   filterMatchMode="contains"  style="text-align: center">
					<h:outputText value="#{asesor.lotesCredito}" />
				</p:column>
				<p:column headerText="Total Comisión Crédito"   filterMatchMode="contains"  style="text-align: center">
					<h:outputText value="#{asesor.comisionCredito}" />
				</p:column>
				<p:column headerText="Tipo de Bono"   filterMatchMode="contains" style="text-align: center" >
					<h:outputText value="#{comisionesBean.asignarTipoBono(asesor)}" />
				</p:column>
				<p:column headerText="Sueldo Básico Bono"   filterMatchMode="contains" style="text-align: center" >
					<h:outputText value="#{comisionesBean.obtenerSueldoBasicoAsesorBono(asesor)}" />
				</p:column>
				<p:column headerText="Bono" filterMatchMode="contains" style="text-align: center" >
					<h:outputText value="#{comisionesBean.obtenerBonoAsesor(asesor)}" />
				</p:column>
				<p:column headerText="Total Comisiones" filterMatchMode="contains" style="text-align: center" >
					<h:outputText value="#{asesor.totalComision}" />
				</p:column>
				<p:column headerText="Pago del Mes" filterMatchMode="contains" style="text-align: center" >
					<h:outputText value="#{comisionesBean.pagoMesAsesor(asesor)}" style="color:blue;"/>
				</p:column>
			</p:dataTable>
		</h:form>
	</p:dialog>
</ui:composition>