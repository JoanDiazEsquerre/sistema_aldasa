<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	locale="#{localeBean.usedLocale}"
	xmlns:f="http://java.sun.com/jsf/core">


	<h:form id="form">
		<h2 style="color: #007d4c;">RECURSOS HUMANOS > PLANILLAS</h2>
		
		<p:tabView id="tabView">
			<p:tab title="Lista de Planillas"> 
				<p:selectOneButton value="#{planillaBean.estado}" unselectable="false">
					<f:selectItem itemLabel="Activos" itemValue="#{true}" />
					<f:selectItem itemLabel="Inactivos" itemValue="#{false}" />
					<p:ajax update=":form:tabView:idTable" />
				</p:selectOneButton>
				
				<p:dataTable var="pl" id="idTable" value="#{planillaBean.lstPlanillaLazy}" widgetVar="planillaTable" rowIndexVar="row" paginator="true" rows="15" size="small"
					emptyMessage="No se encontraron resultados"	paginatorPosition="bottom" rowKey="#{pl.id}" selection="#{planillaBean.planillaSelected}" selectionMode="single">
					
					<p:ajax event="rowSelect" listener="#{planillaBean.verDetalles}" update=":formDP" onstart="PF('blockUIWidget').block();" oncomplete="PF('blockUIWidget').unblock();PF('DPDialog').show();" />
				
					<f:facet name="header">
						<div class="p-d-flex p-ai-center p-jc-between">
							<span>Lista de Planillas</span>
						</div>
					</f:facet>
				
					<p:column style="width:45px;text-align: left">
						<f:facet name="header">
							<p:commandLink action="#{planillaBean.verDetalles}"
								update=":formDP"
								onstart="PF('blockUIWidget').block();" oncomplete="PF('blockUIWidget').unblock();PF('DPDialog').show();"
								title="NUEVA PLANTILLA">
								<p:graphicImage width="50" value="/recursos/images/anadir.png" />
							</p:commandLink>
						</f:facet>
					</p:column>
			
					<p:column width="25px">
			                      #{row +1}
			        </p:column>
			        
					<p:column filterStyle="width: 90%; font-size: 9px;" style="text-align:center;"   headerText="Periodo" sortBy="#{pl.periodo}" filterBy="#{pl.periodo}" id="c_periodo" >  
			            #{pl.periodo}
			        </p:column> 
			        <p:column filterStyle="width: 80%;" style="text-align: center; " headerText="Mes"   sortBy="#{pl.mes}" filterBy="#{pl.mes}" filterOptions="#{planillaBean.cboMes}" id="c_mes" >  
			            #{(pl.mes eq 1?'Enero':(pl.mes eq 2?'Febrero':(pl.mes eq 3?'Marzo':(pl.mes eq 4?'Abril':(pl.mes eq 5?'Mayo':(pl.mes eq 6?'Junio':(pl.mes eq 7?'Julio':(pl.mes eq 8?'Agosto':(pl.mes eq 9?'Septiembre':(pl.mes eq 10?'Octubre':(pl.mes eq 11?'Noviembre':(pl.mes eq 12?'Diciembre':''))))))))))))}
			        </p:column>   
			        <p:column  filterStyle="width: 80%;font-size: 9px;" headerText="Tipo Planilla:" sortBy="#{pl.tipoPlanilla}" filterBy="#{pl.tipoPlanilla}" filterOptions="#{planillaBean.cboTipoPlanilla}" id="id_tipo_planilla">  
			            <h:outputText value="#{pl.tipoPlanilla}" />
			        </p:column>  
			       
			        <p:column  filterStyle="width: 90%;" style="text-align:center;"  headerText="Sucursal:" filterBy="#{pl.sucursal.razonSocial}">  
			            <h:outputText value="#{pl.sucursal.razonSocial}" />
			        </p:column>
			        <p:column  filterStyle="width: 90%;" style="text-align:center;"  headerText="Usuario:">  
			            <h:outputText value="#{pl.usuario.username}" />
			        </p:column>
			        <p:column  filterStyle="width: 90%;" style="text-align:center;"  headerText="Fecha Registro:">  
			            <h:outputText value="#{pl.fechaRegistro}">
			                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
			            </h:outputText>
			        </p:column>
				</p:dataTable>
			</p:tab>
			
			<p:tab title="Nueva Planilla" id="tabListDoc"> 
				<h:panelGrid columns="11">
					<p:outputLabel value="Sucursal:" style="margin-left: 10px"/>
					<p:selectOneMenu id="sucursal" value="#{planillaBean.sucursal}" disabled="#{planillaBean.bloqueo}" style="margin:5px;width:250px" converter="#{planillaBean.conversorSucursal}">
						<f:selectItems value="#{planillaBean.lstSucursal}" var="suc" itemLabel="#{suc.razonSocial}" itemValue="#{suc}"/> 
						<p:ajax update=":form:tabView:idTableEmpleado" listener="#{planillaBean.listarDetallePlantillaTemporal}" />
					</p:selectOneMenu>
					
					<p:outputLabel value="Periodo :" style="margin-left: 15px"/>
	                <p:selectOneMenu value="#{planillaBean.periodo}" disabled="#{planillaBean.bloqueo}">
	                	<f:selectItem itemLabel="2022" itemValue="2022"/>
	                	<f:selectItem itemLabel="2023" itemValue="2023"/>
	                    <f:selectItem itemLabel="2024" itemValue="2024"/>
	                    <f:selectItem itemLabel="2025" itemValue="2025"/>
	                    <f:selectItem itemLabel="2026" itemValue="2026"/>
	                    <f:selectItem itemLabel="2027" itemValue="2027"/>
	                    <f:selectItem itemLabel="2028" itemValue="2028"/>
	                    <f:selectItem itemLabel="2029" itemValue="2029"/>
	                    <f:selectItem itemLabel="2030" itemValue="2030"/>
	                    <f:selectItem itemLabel="2031" itemValue="2031"/>
	                    <f:selectItem itemLabel="2032" itemValue="2032"/>
	                    <f:selectItem itemLabel="2033" itemValue="2033"/>
	                </p:selectOneMenu>
                
                	<p:outputLabel value="Mes :" style="margin-left: 15px"/>
                   	<p:selectOneMenu value="#{planillaBean.mes}" disabled="#{planillaBean.bloqueo}">
                       <f:selectItem itemLabel="Enero"   	itemValue="01"/>
                       <f:selectItem itemLabel="Febrero"    itemValue="02"/>
                       <f:selectItem itemLabel="Marzo"      itemValue="03"/>
                       <f:selectItem itemLabel="Abril"      itemValue="04"/>
                       <f:selectItem itemLabel="Mayo"       itemValue="05"/>
                       <f:selectItem itemLabel="Junio"      itemValue="06"/>
                       <f:selectItem itemLabel="Julio"      itemValue="07"/>
                       <f:selectItem itemLabel="Agosto"     itemValue="08"/>
                       <f:selectItem itemLabel="Septiembre" itemValue="09"/>
                       <f:selectItem itemLabel="Octubre"    itemValue="10"/>
                       <f:selectItem itemLabel="Noviembre"  itemValue="11"/>
                       <f:selectItem itemLabel="Diciembre"  itemValue="12"/>
                   	</p:selectOneMenu>
                        
                    <p:outputLabel value="Tipo Planilla :" style="margin-left: 15px"/>
                    <p:selectOneMenu value="#{planillaBean.tipoPlanilla}" disabled="#{planillaBean.bloqueo}">
                        <f:selectItem itemLabel="DEPENDIENTE" itemValue="#{true}"/>
                        <f:selectItem itemLabel="INDEPENDIENTE" itemValue="#{false}"/>
						<p:ajax update=":form:tabView:idTableEmpleado" listener="#{planillaBean.listarDetallePlantillaTemporal}" />
                    </p:selectOneMenu>
                    
                    <h:outputLabel for="optionPerson" value="Empleado:" style="margin-left: 15px"/>
					<p:autoComplete scrollHeight="300" styleClass="ui-autocompV" value="#{planillaBean.empleado}" 
						converter="#{planillaBean.conversorEmpleado}" id="optionPerson" completeMethod="#{planillaBean.completeEmpleado}"  
	                	var="per" itemLabel="#{per.person.surnames.concat(' ')}#{per.person.names}" itemValue="#{per}" forceSelection="true" />
					<p:commandButton icon="pi pi-check" styleClass="rounded-button" actionListener="#{planillaBean.agregarDetalle}" update=":form:tabView:idTableEmpleado"/>
				</h:panelGrid>
				
				<h:panelGrid columns="4">
					<p:commandButton value="GUARDAR" />
                    <p:commandButton value="CANCELAR" />
                    <p:commandButton value="TERMINAR" />
				</h:panelGrid>
				
				<p:dataTable var="dp" id="idTableEmpleado" value="#{planillaBean.lstDetallePlanillaTemp}" widgetVar="empleadoTable" rowIndexVar="row" paginator="true" rows="15" size="small"
					emptyMessage="No se encontraron empleados." style="font-size: 14px"	paginatorPosition="bottom" rowKey="#{dp.id}" selectionMode="single">
					
				
					<f:facet name="header">
						<div class="p-d-flex p-ai-center p-jc-between">
							<span>Detalle de Planilla</span>
						</div>
					</f:facet>
				
					<p:column width="25px">
			                      #{row +1}
			        </p:column>
			        
			        <p:column headerText="Sucursal" sortBy="#{dp.empleado.sucursal.razonSocial}" filterMatchMode="contains">
						<h:outputText value="#{dp.empleado.sucursal.razonSocial}" />
					</p:column>
			        
					<p:column headerText="Empleado" sortBy="#{dp.empleado.person.surnames}" filterBy="#{dp.empleado.person.surnames}" filterMatchMode="contains">
						<h:outputText value="#{dp.empleado.person.surnames} #{dp.empleado.person.names}" />
					</p:column>
				
					<p:column headerText="Cargo" style="text-align:center;">
						<h:outputText value="#{dp.empleado.cargo.descripcion}" />
					</p:column>
				
					<p:column headerText="Planilla" sortBy="#{dp.empleado.planilla}" filterMatchMode="contains" rendered="false">
						<h:outputText value="#{dp.empleado.planilla? 'SI':'NO'}" />
					</p:column>
					<p:column headerText="Fondo Pensión" sortBy="#{dp.empleado.fondoPension.nombre}" filterMatchMode="contains">
						<h:outputText value="#{dp.empleado.fondoPension.nombre}" />
					</p:column>
					
					<p:column headerText="Sueldo Básico" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.empleado.sueldoBasico}" style="font-weight: bold"> 
						 <f:convertNumber currencySymbol="" type="currency"  />
						 </h:outputText>
					</p:column>
					
					<p:column headerText="Tardanza" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.tardanza}" > 
						 <f:convertNumber currencySymbol="" type="currency"  />
						 </h:outputText>
					</p:column>
					
					<p:column headerText="Vacaciones" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.vacaciones}" > 
						 <f:convertNumber currencySymbol="" type="currency"  />
						 </h:outputText>
					</p:column>
					
					<p:column headerText="Comisiones" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.comisiones}" > 
						 <f:convertNumber currencySymbol="" type="currency"  />
						 </h:outputText>
					</p:column>
					
					<p:column headerText="Bono" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.bono}" > 
						 <f:convertNumber currencySymbol="" type="currency"  />
						 </h:outputText>
					</p:column>
					
					<p:column headerText="Total" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.total}" style="font-weight: bold" > 
						 <f:convertNumber currencySymbol="" type="currency"  />
						 </h:outputText>
					</p:column>
					
					<p:column headerText="ONP SNP" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.onp}" > 
						 <f:convertNumber currencySymbol="" type="currency"  />
						 </h:outputText>
					</p:column>
					
					<p:column headerText="AP. OBLIG." filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.aporteObligatorio}" > 
						 <f:convertNumber currencySymbol="" type="currency"  />
						 </h:outputText>
					</p:column>
					
					<p:column headerText="SEG. INV." filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.primaSeguros}" > 
							<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
					<p:column headerText="COM. VAR." filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.comisionVariable}" > 
							<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
					<p:column headerText="REN. 5TA." filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.rentaQuinta}" > 
						 	<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
					<p:column headerText="DESC. MES ANT." filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.descMesAnterior}" > 
							<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
					<p:column headerText="PAGO VAC. TRUN." filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.pagoVacTrunca}" > 
						 	<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
					<p:column headerText="ADELANTO" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.adelanto}" > 
							<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
					<p:column headerText="PRÉSTAMO" filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.prestamo}" > 
							<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
					<p:column headerText="TOTAL DESC." filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.totalDescuento}" style="font-weight: bold"> 
							<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
					<p:column headerText="NETO A PAGAR." filterMatchMode="contains" style="text-align: center">
						<h:outputText value="#{dp.netoPagar}" style="font-weight: bold"> 
							<f:convertNumber currencySymbol="" type="currency"  />
						</h:outputText>
					</p:column>
					
				</p:dataTable>
			</p:tab>
		</p:tabView>
	</h:form>
	

	
	<p:dialog modal="true"  closeOnEscape="true" header="DETALLES PLANILLA" hideEffect="drop" showEffect="drop" id="dialogDP"  widgetVar="DPDialog" 
		resizable="false"  width="100%" appendTo="@(body)" style="width:auto">  
        <h:form id="formDP" >
            <p:panelGrid style="font-size: 12px;" styleClass="companyHeaderGrid" >
                <p:row>
                    <p:column>
                        <p:outputLabel style="font-size: 13px;font-weight: bold;color: #036fab;" value="PERIODO :"/>
                    </p:column>
                    <p:column>
                        <p:outputLabel style="font-size: 17px;font-weight: bold;color: black;" value="#{planillaBean.planillaSelected.periodo} - #{(planillaBean.planillaSelected.mes eq 1?'Enero':(planillaBean.planillaSelected.mes eq 2?'Febrero':(planillaBean.planillaSelected.mes eq 3?'Marzo':(planillaBean.planillaSelected.mes eq 4?'Abril':(planillaBean.planillaSelected.mes eq 5?'Mayo':(planillaBean.planillaSelected.mes eq 6?'Junio':(planillaBean.planillaSelected.mes eq 7?'Julio':(planillaBean.planillaSelected.mes eq 8?'Agosto':(planillaBean.planillaSelected.mes eq 9?'Septiembre':(planillaBean.planillaSelected.mes eq 10?'Octubre':(planillaBean.planillaSelected.mes eq 11?'Noviembre':(planillaBean.planillaSelected.mes eq 12?'Diciembre':''))))))))))))}"/>
                    </p:column>
                </p:row>
                <p:row>
                    <p:column>
                        <p:outputLabel style="font-size: 13px;font-weight: bold;color: #036fab;" value="TIPO PLANILLA :"/>
                    </p:column>
                    <p:column>
                        <p:outputLabel style="font-size: 17px;font-weight: bold;color: black;" value="#{(fn:escapeXml(planillaBean.planillaSelected.tipoPlanilla)) eq 'D'?'Dependiente':'Independiente'}"/>
                    </p:column>
                  
                </p:row>
            </p:panelGrid>
            
        </h:form>
    </p:dialog>
	
	<pe:blockUI widgetVar="blockUIWidget">
	    <h:form style="background: white"> 
	    	<h:outputText value="Cargando, espere..." style="white-space: nowrap; font-weight:bold; color: #036fab; background: white"/> 
	    </h:form>
    </pe:blockUI>
	


</ui:composition>