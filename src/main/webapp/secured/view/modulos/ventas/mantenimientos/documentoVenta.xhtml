<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	locale="#{localeBean.usedLocale}"
	xmlns:f="http://java.sun.com/jsf/core">


	<h:form id="form">
		<h2 style="color: #007d4c;">VENTAS > DOCUMENTO DE VENTA</h2>
		<p:tabView id="tabView">
			<p:tab title="Lista de Documentos de Venta" id="tabListDoc">
				<p:selectOneButton value="#{documentoVentaBean.estado}" unselectable="false">
					<f:selectItem itemLabel="Activos" itemValue="#{true}" />
					<f:selectItem itemLabel="Inactivos" itemValue="#{false}" />
					<p:ajax update=":form:tabView:idTableListDoc" listener="#{documentoVentaBean.iniciarLazy()}" />
				</p:selectOneButton> 
				
					<p:dataTable var="documento" id="idTableListDoc" value="#{documentoVentaBean.lstDocumentoVentaLazy}" rowIndexVar="row" paginator="true" rows="15" size="small"
					emptyMessage="No se encontraron documentos de venta." style="width:130%" 	paginatorPosition="bottom" rowKey="#{documento.id}" selection="#{documentoVentaBean.documentoVentaSelected}" selectionMode="single">
					
						<f:facet name="header">
							<div class="p-d-flex p-ai-center p-jc-between">
								<span>Lista de Empleados</span>
							</div>
						</f:facet>
				
						<p:column width="25px">
				                      #{row +1}
				        </p:column>
				        
						<p:column headerText="Cliente" sortBy="#{documento.cliente.person.surnames}" filterBy="#{documento.cliente.person.surnames}" filterMatchMode="contains">
							<h:outputText value="#{documento.cliente.person.surnames} #{documento.cliente.person.names}" />
						</p:column>
						
						<p:column headerText="Documento Venta" filterMatchMode="contains">
							<h:outputText value="#{documento.documentoVentaRef}" />
						</p:column>
						
						<p:column headerText="Sucursal" sortBy="#{documento.sucursal.razonSocial}" filterBy="#{documento.sucursal.razonSocial}" filterMatchMode="contains">
							<h:outputText value="#{documento.sucursal.razonSocial}" />
						</p:column>
						
						<p:column headerText="Tipo Comprobante" filterMatchMode="contains">
							<h:outputText value="#{documento.tipoComprobante}" />
						</p:column>
						
						<p:column headerText="Serie" filterMatchMode="contains">
							<h:outputText value="#{documento.serie}" />
						</p:column>
						
						<p:column headerText="Número" filterMatchMode="contains">
							<h:outputText value="#{documento.numero}" />
						</p:column>
						
						<p:column headerText="Ruc"  filterMatchMode="contains">
							<h:outputText value="#{documento.ruc}" />
						</p:column>
						
						<p:column headerText="DNI"  filterMatchMode="contains">
							<h:outputText value="#{documento.dni}" />
						</p:column>
						
						<p:column headerText="Razón Social"  filterMatchMode="contains">
							<h:outputText value="#{documento.razonSocial}" />
						</p:column>
						
						<p:column headerText="Nombre Comercial"  filterMatchMode="contains">
							<h:outputText value="#{documento.nombreComercial}" />
						</p:column>
						
						<p:column headerText="Dirección" filterMatchMode="contains">
							<h:outputText value="#{documento.direccion}" />
						</p:column>
						
						<p:column headerText="Fecha Emision" filterMatchMode="contains">
							<h:outputText value="#{documento.fechaEmision}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>
						
						<p:column headerText="Tipo Moneda" filterMatchMode="contains">
							<h:outputText value="#{documento.tipoMoneda}" />
						</p:column>
						
						<p:column headerText="Observación" filterMatchMode="contains">
							<h:outputText value="#{documento.observacion}" />
						</p:column>
						
						<p:column headerText="Condición Pago"  filterMatchMode="contains">
							<h:outputText value="#{documento.condionPago}" />
						</p:column>
						
						<p:column headerText="SubTotal" filterMatchMode="contains">
							<h:outputText value="#{documento.subTotal}" />
						</p:column>
						
						<p:column headerText="IGV" filterMatchMode="contains">
							<h:outputText value="#{documento.igv}" />
						</p:column>
						
						<p:column headerText="Total"  filterMatchMode="contains">
							<h:outputText value="#{documento.total}" />
						</p:column>
			
						<p:column headerText="Fecha Registro" filterMatchMode="contains">
							<h:outputText value="#{documento.fechaRegistro}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>
						
						<p:column headerText="Usuario Registro" sortBy="#{documento.usuarioRegistro.username}" filterBy="#{documento.usuarioRegistro.username}" filterMatchMode="contains">
							<h:outputText value="#{documento.usuarioRegistro.username}" />
						</p:column>
						
					</p:dataTable>
			</p:tab>
			
			<p:tab title="Nuevo Documento de Venta" >
			<h:panelGrid columns="8" id="gridNuevoDoc"> 
			
				<h:outputLabel  value="Fecha: " />
				<p:datePicker  value="#{documentoVentaBean.documentoVentaNew.fechaEmision}" style="margin:5px;"> 
					<p:ajax update="txt_fecha_Formated" />				
				</p:datePicker>
				
				<h:outputText style="font-size: 22px; font-weight: bold; color: #547E11;" id="txt_fecha_Formated" value="#{documentoVentaBean.documentoVentaNew.fechaEmision}" >
                    <f:convertDateTime pattern="EEEEE, dd MMMM yyyy"/>
                </h:outputText>
								
				<h:outputLabel value="Documento:"  />
				<p:selectOneMenu  value="#{documentoVentaBean.tipoDocumento}" style="margin:5px; width:100px">
					<f:selectItem itemLabel="Factura" itemValue="F" /> 
					<f:selectItem itemLabel="Boleta" itemValue="B"/>
					<p:ajax listener="#{documentoVentaBean.listarSerie}" update="optionSerie, num"></p:ajax>
				</p:selectOneMenu>
					
				<h:outputLabel value="Serie-Número:"  />
                
                <p:selectOneMenu id="optionSerie" value="#{documentoVentaBean.serieDocumentoSelected}" converter="#{documentoVentaBean.conversorSerie}" style="margin:10px" >
                   <f:selectItems value="#{documentoVentaBean.lstSerieDocumento}" var="serie" itemLabel="#{serie.serie}" itemValue="#{serie}"/>
                </p:selectOneMenu>
                
				<p:inputText value="#{documentoVentaBean.serieDocumentoSelected.numero}" style="margin:10px" id="num" > </p:inputText> 
			
			</h:panelGrid>	
				
			<h:panelGrid columns="2" > 
			
			<h:panelGrid columns="8" id="gridImpCuota"> 
					<p:commandButton id="movieBtn" style="font-size: 14px;" value="Importar Cuota" icon="pi pi-search" actionListener="#{documentoVentaBean.listarCuota()}" update=":form:tabView:tableCuota"/>
					<p:overlayPanel for="movieBtn" dynamic="true" style="width:600px" widgetVar="moviePicker" >
						<p:dataTable var="cuota" value="#{documentoVentaBean.lstCuota}"  rows="5" paginator="true" selectionMode="single" rowIndexVar="row" paginatorPosition="bottom" 
							selection="#{documentoVentaBean.cuotaSelected}" rowKey="#{cuota.id}" id="tableCuota" emptyMessage="No se encontraron resultados" size="small">
<!-- 							<p:ajax event="rowSelect" listener="#{contratoBean.seleccionarLote()}" oncomplete="PF('moviePicker').hide()" update=":form:tabView:gridImpCuota"/> -->
	
							<p:column headerText="Mz-Lt" style="text-align:center; width:60px">
								<h:outputText value="#{cuota.contrato.lote.manzana.name} - #{cuota.contrato.lote.numberLote}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Persona Venta" style="text-align:center; width:60px" >
								<h:outputText value="#{cuota.contrato.personVenta.surnames}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Fecha Pago" style="text-align:center; width:60px">
								<h:outputText value="#{cuota.fechaPago}" style="font-size: 14px;"> 
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>
	
							<p:column headerText="Cuota SI" style="text-align:center; width:60px">
								<h:outputText value="#{cuota.cuotaSI}" style="font-size: 14px;"/>
							</p:column>
	
							<p:column headerText="Interés" style="text-align:center; width:60px">
								<h:outputText value="#{cuota.interes}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Cuota Total" style="text-align:center; width:60px">
								<h:outputText value="#{cuota.cuotaTotal}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Adelanto" style="text-align:center; width:60px">
								<h:outputText value="#{cuota.adelanto}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Pago Total" style="text-align:center; width:60px">
								<h:outputText value="#{cuota.pagoTotal}" style="font-size: 14px;"/>
							</p:column>
							
						</p:dataTable>
					</p:overlayPanel>
				
				
					<h:outputText value="Lote: " style="font-size: 20px;font-weight: bolder;" rendered="#{contratoBean.loteSelected ne null}"/>
					<h:outputText value="#{contratoBean.nombreLoteSelected}" style="font-size: 20px;color:#007d4c;font-weight: bolder;" rendered="#{contratoBean.loteSelected ne null}"/>
					
					<p:commandLink actionListener="#{contratoBean.eliminarLoteSelected}" update=":form:tabView:gridImpCuota" title="ELIMINAR" >
                        <p:graphicImage value="/recursos/images/eliminar.gif" rendered="#{contratoBean.loteSelected ne null}" />
                    </p:commandLink>
				</h:panelGrid>
				
				<h:panelGrid columns="5" id="gridImpVoucher"> 
					<p:commandButton id="movieBtnVou" style="font-size: 14px;" value="Importar Voucher Inicial" icon="pi pi-search" actionListener="#{documentoVentaBean.listarVoucher()}" update=":form:tabView:tableVoucher"/>
					<p:overlayPanel for="movieBtnVou" dynamic="true" style="width:600px" widgetVar="moviePicker" >
						<p:dataTable var="voucher" value="#{documentoVentaBean.lstVoucher}"  rows="5" paginator="true" selectionMode="single" rowIndexVar="row" paginatorPosition="bottom" 
							selection="#{documentoVentaBean.voucherSelected}" rowKey="#{voucher.id}" id="tableVoucher" emptyMessage="No se encontraron resultados" size="small">
<!-- 							<p:ajax event="rowSelect" listener="#{contratoBean.seleccionarLote()}" oncomplete="PF('moviePicker').hide()" update=":form:tabView:gridImpVoucher"/> -->
	
							<p:column headerText="Cuenta Bancaria" style="text-align:center; width:60px">
								<h:outputText value="#{voucher.cuentaBancaria.numero}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Monto" style="text-align:center; width:60px" >
								<h:outputText value="#{voucher.monto}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Tipo Transacción" style="text-align:center; width:60px">
								<h:outputText value="#{voucher.tipoTransaccion}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Número Transacción" style="text-align:center; width:60px">
								<h:outputText value="#{voucher.numeroTransaccion}" style="font-size: 14px;"/>
							</p:column>
							
							<p:column headerText="Fecha Operación" style="text-align:center; width:60px">
								<h:outputText value="#{voucher.fechaOperacion}" style="font-size: 14px;"> 
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>
	
						</p:dataTable>
					</p:overlayPanel>
				
				
					<h:outputText value="Lote: " style="font-size: 20px;font-weight: bolder;" rendered="#{contratoBean.loteSelected ne null}"/>
					<h:outputText value="#{contratoBean.nombreLoteSelected}" style="font-size: 20px;color:#007d4c;font-weight: bolder;" rendered="#{contratoBean.loteSelected ne null}"/>
					
					<p:commandLink actionListener="#{contratoBean.eliminarLoteSelected}" update=":form:tabView:gridImpVoucher" title="ELIMINAR" >
                        <p:graphicImage value="/recursos/images/eliminar.gif" rendered="#{contratoBean.loteSelected ne null}" />
                    </p:commandLink>
				</h:panelGrid>
								
								
				</h:panelGrid>
				
				
				
				
				
			</p:tab>
		</p:tabView>
	</h:form>
	
</ui:composition>