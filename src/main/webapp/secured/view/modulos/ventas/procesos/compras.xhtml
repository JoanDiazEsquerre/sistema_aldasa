<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	locale="#{localeBean.usedLocale}"
	xmlns:f="http://java.sun.com/jsf/core">

 
	<h:form id="form" enctype="multipart/form-data">
		<p:growl id="msgs" showDetail="true"/>
		<h2 style="color: #007d4c;">VENTAS > COMPRAS</h2>
		
		<p:tabView id="tabView">
			<p:tab title="Lista de compras">
			
				<h:panelGrid columns="5" id="gridOpc" > 
					<p:selectOneButton value="#{comprasBean.estado}" unselectable="false">
						<f:selectItem itemLabel="Pendientes" itemValue="Pendiente" />
						<f:selectItem itemLabel="Aprobados" itemValue="Aprobado" />
						<f:selectItem itemLabel="Rechazados" itemValue="Rechazado" />
						<p:ajax update=":form:tabView:idTableCompra"  />
					</p:selectOneButton> 
					
				</h:panelGrid> 
			
				<p:dataTable var="compra" id="idTableCompra" value="#{comprasBean.lstOrdenCompraLazy}" widgetVar="compraTable" rowIndexVar="row" paginator="true" rows="15" size="small" style="width:auto"
					emptyMessage="No se encontraron compras." paginatorPosition="bottom" rowKey="#{compra.id}" selection="#{comprasBean.ordenCompraSelected}" selectionMode="single"
					lazy="true">
					<f:facet name="header">
						<div class="p-d-flex p-ai-center p-jc-between">
							<span>Lista de Compras</span>
						</div>
					</f:facet>
<!-- 					<p:ajax event="rowSelect" listener="#{comprasBean.updateCompra()}" oncomplete="PF('compraNewDialog').show();" /> -->
<!-- 					<p:ajax event="rowSelect" update=":formDialog :dialogCompra" listener="#{comprasBean.updateCompra()}" oncomplete="PF('compraNewDialog').show();" /> -->
		
					<p:column width="25px">
		                      #{row +1}
		        	</p:column>
		        	
					<p:column headerText="Fecha Emision" filterMatchMode="contains">
						<h:outputText value="#{compra.fechaEmision}" > 
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					
					<p:column headerText="Usuario registro"  filterMatchMode="contains">
						<h:outputText value="#{compra.usuario.username}" />
					</p:column>
					
					<p:column headerText="Fecha Registro" filterMatchMode="contains">
						<h:outputText value="#{compra.fechaRegistro}" > 
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					
					<p:column headerText="Forma de Pago">
		                <h:outputText value="#{compra.formaPago}" />
		            </p:column>
		            
		            <p:column headerText="Observación">
		                <h:outputText value="#{compra.observacion}" />
		            </p:column>
					
					<p:column headerText="Total" filterMatchMode="contains">
						<h:outputText value="#{compra.total}" >
			                <f:convertNumber type="currency" currencySymbol=""/>
			            </h:outputText>
					</p:column>
					
					<p:column headerText="SubTotal" filterMatchMode="contains">
						<h:outputText value="#{compra.subTotal}" >
			                <f:convertNumber type="currency" currencySymbol=""/>
			            </h:outputText>
					</p:column>
					
					<p:column headerText="Igv" filterMatchMode="contains">
						<h:outputText value="#{compra.igv}" >
			                <f:convertNumber type="currency" currencySymbol=""/>
			            </h:outputText>
					</p:column>
					
				</p:dataTable>
				
			</p:tab>
			
			<p:tab title="Registrar nueva compra">
				
				<h:panelGrid columns="2"> 
					<h:outputLabel value="Cantidad: " />
					<p:inputNumber id="cantidad" value="#{comprasBean.cantidad}" style="margin:10px"/> 
					
					<p:outputLabel for="unidad" value="Unidad: " />
					<p:selectOneMenu id="unidad" value="#{comprasBean.unidadFilter}" converter="#{comprasBean.conversorUnidad}" >
						<f:selectItem itemLabel="[--Seleccionar--]" itemValue="#{null}"/>
						<f:selectItems value="#{comprasBean.lstUnidad}" var="unidad" itemLabel="#{unidad.descripcion}" itemValue="#{unidad}"/>
<!-- 						<p:ajax update=":form:idTableLote :form:panelFilter" listener="#{loteBean.listarManzanas}" onstart="PF('blockUIWidget').block();" oncomplete="PF('blockUIWidget').unblock();"/> -->
					</p:selectOneMenu>
					
					<h:outputLabel value="Descripción Producto:" />
					<p:inputText id="descripProd" value="#{comprasBean.descripcionProducto}" style="margin:10px"/>
					
					<h:outputLabel value="Precio: " />
					<p:inputNumber id="precio" value="#{comprasBean.precio}" style="margin:10px"/> 
					
					<h:outputLabel value="Total: " />
					<p:inputNumber id="total" value="#{comprasBean.total}" style="margin:10px"/> 
					
					<p:commandButton value="Agregar Item" actionListener="#{comprasBean.agregarItem()}" update=":form:tabView:idTableDetalle :form:tabView:precio"/>
					<p:commandButton value="Guardar" actionListener="#{comprasBean.saveCompra()}" update=":form:tabView:idTableCompra :form:tabView:idTableDetalle"/>					
				
				</h:panelGrid>
				
				<p:dataTable id="idTableDetalle" var="detalle" value="#{comprasBean.lstDetalleOrdenCompra}" style="width:auto" rowIndexVar="row" paginator="true" rows="15" size="small" 
				emptyMessage="No se agregaron detalles." selection="#{comprasBean.detalleOrdenCompraSelected}">
				
					<p:column headerText="Nro" width="25px">
                      #{row +1}
        			</p:column>
        			
		            <p:column headerText="Cantidad">
		                <h:outputText value="#{detalle.cantidad}" />
		            </p:column>
		            
		            <p:column headerText="Unidad">
		                <h:outputText value="#{detalle.unidad.descripcion}" />
		            </p:column>
		            
		            <p:column headerText="Descripcion Producto">
		                <h:outputText value="#{detalle.descripcionproducto}" />
		            </p:column>
		            
		            <p:column headerText="Precio">
		                <h:outputText value="#{detalle.precio}" />
		            </p:column>
		            
		            <p:column headerText="Total">
		                <h:outputText value="#{detalle.total}" />
		            </p:column>
		            
		            <p:column width="10%" filterMatchMode="contains">
						<p:commandButton action="#{compraBean.deleteDetalle(detalle)}" icon="pi pi-trash" styleClass="rounded-button ui-button-danger" process="@this" update=":form:tabView:idTableDetalle"/>
					</p:column>
		
		        </p:dataTable>
			</p:tab>
			
		</p:tabView>
		
		
	</h:form>
	
</ui:composition>